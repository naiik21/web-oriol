---
import Layout from '../layouts/Layout.astro'
import SectionContainer from '../components/SectionContainer.astro'
import ScrollEffect from '../components/ScrollEffect.astro'
import MarqueeContainer from '../components/MarqueeContainer.astro'
import { Globe } from '../components/MagicUI/Globe'
import BigWordsScroll from '../components/React/BigWordsScroll'
---

<Layout title='Oriol Ortega | Home'>
  <main class=''>
    <SectionContainer class='py-24'>
      <h2
        class='animate-on-scroll leading-none justify-center text-center font-semibold mb-6 flex gap-x-2 items-center w text-[38px] xl:text-[84px] lg:text-[80px] md:text-[74px] sm:text-[58px]'>
        Historias que inspiran y conectan
      </h2>
      <p
        class='animate-on-scroll mb-4 text-xl max-w-[850px] text-center my-5 mx-auto'>
        Cada proyecto es una oportunidad para crear algo especial. Desde eventos
        hasta campañas de marca, capturo la esencia de cada momento.
      </p>
      <div class='grid gap-5 md:grid-cols-4 md:grid-rows-5'>
        <div class='md:col-span-2 md:row-span-2'>
          <video
            class='animate-on-scroll gift-video'
            src='./gifs-home-3.mp4'
            loop
            muted
            playsinline></video>
        </div>
        <div
          class='col-start-1 row-start-4 md:col-span-2 md:row-span-2 md:col-start-3'>
          <video
            class='animate-on-scroll gift-video'
            src='./gifs-home-4.mp4'
            loop
            muted
            playsinline></video>
        </div>
        <div
          class='row-span-2 col-start-1 row-start-2 md:col-span-2 md:row-span-3 md:row-start-3'>
          <video
            class='animate-on-scroll gift-video'
            src='./gifs-home-1.mp4'
            loop
            muted
            playsinline></video>
        </div>
        <div
          class='row-span-2 row-start-5 md:col-span-2 md:row-span-3 md:col-start-3 md:row-start-3'>
          <video
            class='animate-on-scroll gift-video'
            src='./gifs-home-2.mp4'
            loop
            muted
            playsinline></video>
        </div>
      </div>
    </SectionContainer>

    <BigWordsScroll client:visible='react' />

    <MarqueeContainer />

    <Globe client:load />

    <ScrollEffect
      text='¿Listo para crear algo increible?'
      class='bg-[#0D0D0D]'
    />
  </main>
</Layout>

<script>
  // Detecta si es un dispositivo móvil
  const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent)

  if (isMobile) {
    // Selecciona todos los videos en la página
    const videos = document.querySelectorAll('video')

    // Función para pausar todos los videos
    const pauseAllVideos = () => {
      videos.forEach((video) => video.pause())
    }

    // Función para encontrar el video más centrado en pantalla
    const getMostCenteredVideo = () => {
      let mostCenteredVideo = null
      let smallestOffset = Infinity

      videos.forEach((video) => {
        const rect = video.getBoundingClientRect()
        const videoCenter = rect.top + rect.height / 2
        const screenCenter = window.innerHeight / 2
        const offset = Math.abs(screenCenter - videoCenter)

        if (offset < smallestOffset) {
          smallestOffset = offset
          mostCenteredVideo = video
        }
      })

      return mostCenteredVideo
    }

    // Evento para manejar el scroll y reproducir el video adecuado
    const handleScroll = () => {
      const centeredVideo = getMostCenteredVideo()

      if (centeredVideo) {
        pauseAllVideos()
        centeredVideo.play()
      }
    }

    // Escucha el evento de scroll
    window.addEventListener('scroll', handleScroll)

    // Ejecuta la lógica al cargar la página
    handleScroll()
  }
</script>
